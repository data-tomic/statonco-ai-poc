<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StatOnco PoC (–≠—Ç–∞–ø 0: –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö)</title> <!-- –ò–∑–º–µ–Ω–µ–Ω Title -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* –°—Ç–∏–ª–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å */
        .spinner-border { width: 3rem; height: 3rem; }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.7); z-index: 1050; justify-content: center; align-items: center; flex-direction: column; /* –î–ª—è —Ç–µ–∫—Å—Ç–∞ –ø–æ–¥ —Å–ø–∏–Ω–Ω–µ—Ä–æ–º */ }
        .alert { word-wrap: break-word; }
    </style>
</head>
<body>
    <nav class="navbar navbar-light bg-light mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">
                üî¨ StatOnco PoC: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ê–Ω–∞–ª–∏–∑
            </a>
        </div>
    </nav>

    <div class="container">
        <!-- Flash —Å–æ–æ–±—â–µ–Ω–∏—è -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message | safe }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <h2>–≠—Ç–∞–ø 0: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</h2>
        <hr>
         <!-- –ò–ó–ú–ï–ù–ï–ù–ê –§–û–†–ú–ê: action —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç -->
         <form method="POST" action="{{ url_for('start_analysis') }}" enctype="multipart/form-data" id="start-analysis-form">
             <div class="row">
                 <div class="col-md-6 mb-3">
                     <label for="file" class="form-label">1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel —Ñ–∞–π–ª (.xlsx)</label>
                     <input class="form-control" type="file" id="file" name="file" accept=".xlsx" required>
                 </div>
                 <div class="col-md-6 mb-3">
                     <label for="query" class="form-label">2. –û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –∞–Ω–∞–ª–∏–∑–∞</label>
                     <textarea class="form-control" id="query" name="query" rows="4" placeholder="–ü—Ä–∏–º–µ—Ä—ã: '–°—Ä–∞–≤–Ω–∏ —Å—Ä–µ–¥–Ω–∏–π –≤–æ–∑—Ä–∞—Å—Ç –≤ –≥—Ä—É–ø–ø–∞—Ö —Å —Ä–µ—Ü–∏–¥–∏–≤–æ–º –∏ –±–µ–∑ —Ä–µ—Ü–∏–¥–∏–≤–∞', '–ü–æ—Å—á–∏—Ç–∞–π —á–∞—Å—Ç–æ—Ç—É —Å—Ç–∞–¥–∏–π T', '–ï—Å—Ç—å –ª–∏ —Å–≤—è–∑—å –º–µ–∂–¥—É —Ç–∏–ø–æ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –ø–æ—Å–ª–µ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏—è–º–∏?'" required>{{ request.form.get('query', '') }}</textarea> <!-- –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–≤–æ–¥ –ø—Ä–∏ –æ—à–∏–±–∫–µ -->
                 </div>
             </div>
             <button type="submit" class="btn btn-primary w-100">
                 –ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞–Ω–Ω—ã—Ö ‚Üí
             </button>
         </form>

         <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
         <div class="loading-overlay" id="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <p class="ms-2 mt-2">–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑...</p> <!-- –ò–∑–º–µ–Ω–µ–Ω —Ç–µ–∫—Å—Ç -->
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –£–î–ê–õ–ï–ù–ê –æ—Ç—Å—é–¥–∞ -->

    </div>

    <footer class="mt-5 text-center text-muted">
        <hr>
        <p>StatOnco PoC v0.4 (–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- –ò–ó–ú–ï–ù–ï–ù –°–ö–†–ò–ü–¢: ID —Ñ–æ—Ä–º—ã -->
    <script>
        document.getElementById('start-analysis-form').addEventListener('submit', function(event) {
             // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ (–±—Ä–∞—É–∑–µ—Ä —Å–¥–µ–ª–∞–µ—Ç –¥–ª—è required –ø–æ–ª–µ–π)
             const fileInput = document.getElementById('file');
             const queryInput = document.getElementById('query');
             if (!fileInput.files || fileInput.files.length === 0) {
                 // alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.'); // –ú–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ required –¥–æ–ª–∂–Ω–æ —Ö–≤–∞—Ç–∏—Ç—å
                 // event.preventDefault(); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                 // return;
             }
             if (!queryInput.value.trim()) {
                // alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å.');
                // event.preventDefault();
                // return;
             }
             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø—Ä–æ–π–¥–µ–Ω–∞
             if (this.checkValidity()) {
                document.getElementById('loading-spinner').style.display = 'flex';
             }
        });
    </script>
</body>
</html>
